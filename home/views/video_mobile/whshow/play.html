<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="" name="Keywords">
    <meta content="" name="Description">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="<{$res}>/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="<{$res}>/css/main.css"/>
    <link rel="stylesheet" href="<{$res}>/css/swiper.min.css"/>
    <link rel="stylesheet" href="<{$res}>/css/video.css?v=bcd2ce1385" rel="stylesheet">

    <title>播放</title>
</head>
<body>
<!--通用顶部-->
<header>
    <ul class="header">
        <li class="both_header"><a href="JavaScript:history.Go(-1)" class="icon_return"></a></li>
        <li class="middle_title" id="scrollDiv"><marquee scrollAmount=2 behaviour="Scroll" onmouseover=stop() onmouseout=start()>好男儿之情感护理&nbsp;第一集</marquee></li>
        <li class="both_header"><a href="index.html" class="icon_home"><img src="<{$res}>/images/icon_home.png"></a></li>
    </ul>
</header>
<section>
    <video id="roomVideo" class="video-js vjs-default-skin vjs-big-play-centered" x-webkit-airplay="allow" poster="" webkit-playsinline playsinline x5-video-player-type="h5" x5-video-player-fullscreen="true" preload="auto">
        <source src="http://smarty.com/demos/9Ig6MLgQ/index.m3u8"  type="application/x-mpegURL">
    </video>
    <div class="Episode_style ">
        <a href="javascript:" class="btn Episode_link "><i class="triangle-left "></i>上一集</a>
        <a href="javascript:" class="btnLight on btn Episode_link ">关灯</a>
        <a href="javascript:" class="btn Episode_link "><i class="triangle-right "></i>下一集</a></div>
    <div class="information_style">
        <div class="video_lable_name">好男儿之情感护理&nbsp;第一集 <span class="amount">共24集全</span> <a href="javascript:" class="arrow_link arrow_down"></a></div>
        <div class="panel_style clearfix" style="display:none">
            <p class="relative"><label>导演：</label><span>许诚毅</span></p>
            <p class="relative"><label>类型：</label><span>剧情，喜剧，奇幻</span></p>
            <p class="relative"><label>主演：</label><span>白百何，井柏然，曾志伟，吴君如，姜武，钟汉良 </span></p>
            <p class="relative"><label>介绍：</label><span>简兮从小失去父母，由祖母抚养长大，却依然成为一个乐观积极的少女。祖母去世后，简兮独自离开故乡，远赴北京寻找亲生母亲。遭到母亲展眉的冷漠拒绝后，简兮没有灰心丧气，反而立志成为一个出色的表演艺术家。凭着对表演的一腔热情和杰出天赋，简兮塑造出鲜明各异的角色</span></p>
        </div>
        <div class="Anthology_style clearfix rlt">
            <span class="label_name"> 选集：</span>
            <ul class="Anthology_list  result_album clearfix">
                <li class="on"><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">6</a></li>
                <li><a href="#">7</a></li>
                <li><a href="#">8</a></li>
                <li><a href="#">9</a></li>
                <li><a href="#">10</a></li>
                <li><a href="#">11</a></li>
                <li><a href="#">12</a></li>
                <li><a href="#">13</a></li>
                <li><a href="#">14</a></li>
                <li><a href="#">...</a></li>
                <li><a href="#">26</a></li>
                <li class="album_item album_item-more"><a href="javascript:" class="more_link">更多</a></li>
            </ul>
            <ul class="All_Anthology_list  result_album clearfix hide_s">
                <li><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">6</a></li>
                <li><a href="#">7</a></li>
                <li><a href="#">8</a></li>
                <li><a href="#">9</a></li>
                <li><a href="#">10</a></li>
                <li><a href="#">11</a></li>
                <li><a href="#">12</a></li>
                <li><a href="#">13</a></li>
                <li><a href="#">14</a></li>
                <li><a href="#">15</a></li>
                <li><a href="#">16</a></li>
                <li><a href="#">17</a></li>
                <li><a href="#">18</a></li>
                <li><a href="#">19</a></li>
                <li><a href="#">20</a></li>
                <li><a href="#">21</a></li>
                <li><a href="#">22</a></li>
                <li><a href="#">23</a></li>
                <li><a href="#">24</a></li>
                <li><a href="#">25</a></li>
                <li><a href="#">26</a></li>
                <li class="album_item album_item-hide"><a href="javascript:" class="hide_link">隐藏</a></li>
            </ul>
        </div>
    </div>
    <div class="Related_content">
        <div class="Related_title"><span>相关视频</span></div>
        <div class="list_v_content ">
            <ul class="Notice_list">
                <li class="first_content bg">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/14.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">更新预告</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">轿车公路上行驶被闪电劈中</a></p>
                    </div>
                </li>
                <li class="first_content bg">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/4.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">更新预告</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">轿车公路上行驶被闪电劈中</a></p>
                    </div>
                </li>
                <li class="first_content bg">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/3.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">34集全</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">大秦帝国之纵横</a></p>
                    </div>
                </li>
                <li class="first_content bg hover">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/5.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">更新预告</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">轿车公路上行驶被闪电劈中</a></p>
                    </div>
                </li>
                <li class="first_content bg">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/5.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">更新预告</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">轿车公路上行驶被闪电劈中</a></p>
                    </div>
                </li>
                <li class="first_content bg">
                    <a href="#" class="pic " target="_blank">
                        <img src="<{$res}>/video/5.jpg" width="100%">
                        <span class="first_bg"><i class="icon_bf"></i></span>
                    </a>
                    <a target="_blank" href="#" class="bq">更新预告</a>
                    <div class="tc">
                        <p class="tit">
                            <a target="_blank" href="#">轿车公路上行驶被闪电劈中</a></p>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</section>
<script src="<{$res}>/js/jquery-2.1.js"></script>
<script src="<{$res}>/js/video.js?v=fc5104a2ab23"></script>
<script src="<{$res}>/js/videojs-contrib-hls.js?v=c726b94b9923"></script>
</body>
</html>

<script type="text/javascript">
    var myPlayer = videojs('roomVideo',{
        autoplay:false,
        controls:true,
        preload:'metadata',
        bigPlayButton : true,
        textTrackDisplay : true,
        posterImage: true,
        errorDisplay : true,
        controlBar : true
    },function(){
        console.log(this)
        this.on('loadedmetadata',function(){
            console.log('loadedmetadata');
            //加载到元数据后开始播放视频
            startVideo();
        })

        this.on('ended',function(){
            console.log('ended')
//				window.location.href = "./0520.html";
        })
        this.on('firstplay',function(){
            console.log('firstplay')
        })
        this.on('loadstart',function(){
            //开始加载
            console.log('loadstart')
        })
        this.on('loadeddata',function(){
            console.log('loadeddata')
        })
        this.on('seeking',function(){
            //正在去拿视频流的路上
            console.log('seeking')
        })
        this.on('seeked',function(){
            //已经拿到视频流,可以播放
            console.log('seeked')
        })
        this.on('waiting',function(){
            console.log('waiting')
        })
        this.on('pause',function(){
            console.log('pause');
            /* 暂停 start */
            clearInterval(isVideoBreak);
            myPlayer.pause();
            /* 暂停 end */
        })
        this.on('play',function(){
            console.log('play');
            startVideo();


        })

    });

    var isVideoBreak;
    function startVideo() {

        myPlayer.play();

        //微信内全屏支持
        document.getElementById('roomVideo').style.width = window.screen.width + "px";
        document.getElementById('roomVideo').style.height = window.screen.height + "px";


        //判断开始播放视频，移除高斯模糊等待层
        var isVideoPlaying = setInterval(function(){
            var currentTime = myPlayer.currentTime();
            if(currentTime > 0){
                $('.vjs-poster').remove();
                clearInterval(isVideoPlaying);
            }
        },200)

        //判断视频是否卡住，卡主3s重新load视频
        var lastTime = -1,
                tryTimes = 0;

        clearInterval(isVideoBreak);
        isVideoBreak = setInterval(function(){
            var currentTime = myPlayer.currentTime();
            console.log('currentTime'+currentTime+'lastTime'+lastTime);

            if(currentTime == lastTime){
                //此时视频已卡主3s
                //设置当前播放时间为超时时间，此时videojs会在play()后把currentTime设置为0
                myPlayer.currentTime(currentTime+10000);
                myPlayer.play();

                //尝试5次播放后，如仍未播放成功提示刷新
                if(++tryTimes > 5){
                    alert('您的网速有点慢，刷新下试试');
                    tryTimes = 0;
                }
            }else{
                lastTime = currentTime;
                tryTimes = 0;
            }
        },3000)

    }

    /* 发送弹幕 start */
    function send_danmu(){
        console.log(myPlayer.currentTime());
    }
    /* 发送弹幕 end */
</script>

</script>
